<!DOCTYPE html> 
<html> 
	<head> 
	<title>My Page</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="css/jquery.mobile.min.css" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script src="js/jquery.mobile.min.js"></script>
	<script type="text/javascript">
        $(document).ready(function() {
            $.getJSON("mock/phoneMock.json", function(data) {
                fillContactList(data);
            });
            
            function fillContactList(contacts) {
                // overview page
                var contactList = $('#contactList');
                var i = contacts.length;
                while (i--) {
                    var listItem = document.createElement('li');

                    $('listItem').attr('data-icon','arrow-r');
                    var markup = '<div class="ui-btn-text"><a href="#detail" class="ui-link-inherit detailLink" data-userid="'+ 
                                  contacts[i].ID + '">' + 
                                  '<h2>' + contacts[i].vorname + ' ' + contacts[i].nachname + '</h2>' +
                                  '<p>Durchwahl: <strong>' + contacts[i].durchwahl + '</strong></p></a></div>';

                    listItem.innerHTML = markup;
                    contactList.append(listItem);                    
                }
                contactList.listview('refresh');
                
                // detail page
                $('.detailLink').bind('click', function() {
                    var userId        = this.getAttribute('data-userid');
                    var contactDetail = $('#contactDetail');
                    var i = contacts.length;
                    while (i--) {
                        if (contacts[i].ID === userId) {
                            var contact = contacts[i];
                            break;
                        }
                    }
                    
                    $('#detailHeader').html(contact.vorname + ' ' + contact.nachname    );
                    
                    var listItem = document.createElement('li');
                    var markup = '<li>' + 
                                     '<h2>' + contact.vorname + ' ' + contact.nachname + '</h2>' + 
                                     '<p>Abteilung: ' + contact.abteilung + '</p>' +
                                     '<p>Durchwahl: ' + contact.durchwahl + '</p>' + 
                                     '<p>Nummer: <a href="tel:' + contact.nummer + '">' + contact.nummer + '</a></p>' + 
                                     '<p>E-Mail: <a href="mailto:' + contact.mail + '">' + contact.mail + '</a></p>' +
                                     '<p>Handy: <a href="tel:' + contact.handy + '">' + contact.handy + '</a></p>' +
                                     '<p>Skype: <a href="tel:' + contact.skype + '">' + contact.skype + '</a></p>' +
                                 '</li>';
                    listItem.innerHTML = markup;   
                    
                    contactDetail.children().remove();
                    contactDetail.append(listItem);
                    
                    window.setTimeout(function() {
                        $('#contactDetail').listview('refresh');
                    }, 200);
                });
            }
        })
	</script>
</head> 
<body> 

    <div data-role="page" id="start">

	    <div data-role="header">
		    <h1>phonelist</h1>
	    </div><!-- /header -->

	    <div data-role="content">	
            <ul id="contactList" data-role="listview" data-inset="true" data-filter="true">
            </ul>
	    </div><!-- /content -->
    </div><!-- /page -->

    <div data-role="page" id="detail">
        <div data-role="header">
	        <h1 id="detailHeader"></h1>
            <a href="#start" class="ui-btn-left" data-icon="back" data-direction="reverse" data-iconpos="notext">Home</a>
        </div><!-- /header -->

        <div data-role="content">	
            <ul id="contactDetail" data-role="listview" data-inset="true">
            </ul>
        </div><!-- /content -->
    </div>	

</body>
</html>
